{"version":3,"sources":["../src/ImagePreview.js"],"names":["ANIMATION_DURATION","Scale","throttle","fun","delay","tid","setTimeout","styles","containerStyles","cursor","background","position","top","left","right","bottom","overflow","transition","zIndex","viewStyle","height","initStyle","width","backgroundRepeat","backgroundSize","ImagePreview","img","state","computedImageState","handleResize","getComputedStyle","imageUrl","props","getInitStyles","setState","document","createElement","src","onload","window","addEventListener","removeEventListener","imageTarget","rect","getBoundingClientRect","offsetTop","pageYOffset","transform","imagePreviewSingleton","hide","realWidth","realHeight","windowHeight","innerHeight","windowWidth","innerWidth","realRate","finalWidthScale","finalHeightScale","translateX","translateY","imageStyle","backgroundImage","handleImageClick","bind","Component","propTypes","string","object","ImagePreviewSingleton","$mountEle","body","appendChild","render","unmountComponentAtNode"],"mappings":"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","file":"ImagePreview.js","sourcesContent":["import React from 'react'\r\nimport ReactDom from 'react-dom'\r\nimport PropTypes from 'prop-types'\r\n\r\nconst ANIMATION_DURATION = 0.2;\r\nconst Scale = 0.92;\r\n\r\nfunction throttle (fun, delay) {\r\n  let tid = null;\r\n  return function() {\r\n    if (!tid) {\r\n      tid = setTimeout(() => {\r\n        fun();\r\n        tid = null;\r\n      }, delay);\r\n    }\r\n  }\r\n}\r\n\r\n\r\nconst styles = {\r\n  containerStyles: {\r\n    cursor: 'zoom-out',\r\n    background: 'rgba(0, 0, 0, 0.1)',\r\n    position: 'fixed',\r\n    top: 0,\r\n    left: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    overflow: 'hidden',\r\n    transition: `background-color ${ANIMATION_DURATION}s ease-in-out`,\r\n    zIndex: 1001,\r\n  },\r\n  viewStyle: {\r\n    height: '100%',\r\n    overflow: 'auto',\r\n  },\r\n  initStyle: {\r\n    transition: `transform ${ANIMATION_DURATION}s ease-in-out`,\r\n    width: 0,\r\n    height: 0,\r\n    backgroundRepeat: 'no-repeat',\r\n    backgroundSize: '100% auto',\r\n  }\r\n}\r\n\r\nclass ImagePreview extends React.Component {\r\n\r\n  constructor() {\r\n    super();\r\n    this.img = null;\r\n    this.state = {\r\n      computedImageState: {},\r\n    }\r\n    this.handleResize = throttle(() => {\r\n      this.getComputedStyle();\r\n    }, 200);\r\n  }\r\n\r\n  componentWillMount () {\r\n    const { imageUrl } = this.props;\r\n    styles.initStyle = {\r\n      ...styles.initStyle,\r\n      ...this.getInitStyles(),\r\n    };\r\n    this.setState({\r\n      computedImageState: styles.initStyle,\r\n    })\r\n    // 为了获取图片的原始尺寸\r\n    if (!this.img) {\r\n      this.img = document.createElement('img');\r\n    }  \r\n    this.img.src = imageUrl;\r\n    this.img.onload = () => {\r\n      this.getComputedStyle();\r\n    }\r\n    // 使用节流函数，防止过度渲染\r\n    window.addEventListener('resize', this.handleResize);\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    window.removeEventListener('resize', this.handleResize);\r\n  }\r\n\r\n  getInitStyles () {\r\n    const { imageTarget } = this.props;\r\n    const width = imageTarget.width;\r\n    const height = imageTarget.height;\r\n    const rect = imageTarget.getBoundingClientRect();\r\n    const left = rect.left;\r\n    const top = imageTarget.offsetTop - window.pageYOffset;\r\n    return {\r\n      width,\r\n      height,\r\n      transform: `translate3d(${left}px, ${top}px, 0)`,\r\n    }\r\n  }\r\n\r\n  handleImageClick () {\r\n    this.setState({\r\n      computedImageState: {\r\n        ...styles.initStyle,\r\n      }\r\n    }, () => {\r\n      setTimeout( () => {\r\n        imagePreviewSingleton.hide();\r\n      }, ANIMATION_DURATION * 1000 );\r\n    })\r\n  }\r\n\r\n  getComputedStyle () {\r\n    // 图片的原始尺寸\r\n    const realWidth = this.img.width;\r\n    const realHeight = this.img.height;\r\n    const windowHeight = window.innerHeight;\r\n    const windowWidth = window.innerWidth;\r\n    const realRate = realWidth / realHeight;\r\n    let finalWidthScale, finalHeightScale;\r\n    if (realRate > windowWidth / windowHeight) {\r\n      finalWidthScale = (Scale * windowWidth) / styles.initStyle.width;\r\n      finalHeightScale = ((Scale * windowWidth) / realWidth) * realHeight / styles.initStyle.height;\r\n    } else {\r\n      finalHeightScale = (Scale * windowHeight) / styles.initStyle.height;\r\n      finalWidthScale = (Scale * windowHeight) / realHeight * realWidth / styles.initStyle.width;\r\n    }\r\n    const translateX = (windowWidth - this.state.computedImageState.width) / 2;\r\n    const translateY = (windowHeight - this.state.computedImageState.height) / 2;\r\n    this.setState({\r\n      computedImageState: {\r\n        ...this.state.computedImageState,\r\n        transform: `translate3d(${translateX}px, ${translateY}px, 0) scale3d(${finalWidthScale}, ${finalHeightScale}, 1)`,\r\n      }\r\n    })\r\n  }\r\n\r\n  render () {\r\n    const { imageUrl } = this.props;\r\n    const imageStyle = {\r\n      ...styles.initStyle,\r\n      backgroundImage: `url(${imageUrl})`,\r\n      ...this.state.computedImageState,\r\n    };\r\n\r\n    return (\r\n      <div className=\"image-preview-container\" style={styles.containerStyles} onClick={this.handleImageClick.bind(this)}>\r\n        <div className=\"image-preview\" style={styles.viewStyle}>\r\n          <div style={imageStyle}></div>\r\n        </div>    \r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nImagePreview.propTypes = {\r\n  imageUrl: PropTypes.string,\r\n  imageTarget: PropTypes.object,\r\n}\r\n\r\nexport class ImagePreviewSingleton {\r\n  constructor() {\r\n    this.$mountEle = null;\r\n  }\r\n\r\n  show (imageUrl, imageTarget) {\r\n    if (!this.$mountEle) {\r\n      this.$mountEle = document.createElement('div');\r\n      document.body.appendChild(this.$mountEle);\r\n    }\r\n    ReactDom.render(<ImagePreview imageUrl={imageUrl} imageTarget={imageTarget}/>, this.$mountEle);\r\n  }\r\n\r\n  hide () {\r\n    ReactDom.unmountComponentAtNode(this.$mountEle);\r\n  }\r\n}\r\n\r\nconst imagePreviewSingleton = new ImagePreviewSingleton();\r\nexport { imagePreviewSingleton }"]}